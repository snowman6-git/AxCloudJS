<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket 예제</title>
</head>
<body>
    <h1>WebSocket 통신 예제</h1>
    <input type="text" id="messageInput" placeholder="메시지를 입력하세요">
    <button id="sendButton">전송</button>
    <div id="messages"></div>

    <input type="file" onchange="check()" multiple />

<script>
    function check(){
        const files = event.target.files;
        for (let i = 0; i < files.length; i++) {
            console.log(files[i])
            upload(files[i])
        }  
    }

    const chunkSize = 10 * 1024 * 1024;
    const upload = async (file) => {
        const ws = new WebSocket(`ws://localhost:3000/?id=${file.name}`);

        ws.onopen = () => {
            console.log(`서버에 연결되었습니다: ${ws.url}`);
        };
        ws.onclose = () => {
            console.log('서버와의 연결이 끊어졌습니다.');
        };
        setInterval(() => {
            ws.send(":D");
        }, 100);

        // ws.send("A")
        // const totalChunks = Math.ceil(file.size / chunkSize);
        // let offset = 0;
        // for (let i = 0; i < totalChunks; i++) {
        //     const chunk = file.slice(offset, offset + chunkSize);
        //     // const formData = new FormData();
        //     // formData.append('filename', file.name); // 파일 이름 추가
        //     // formData.append('chunk', chunk); // 청크 추가
        //     ws.send(chunk)
        // }ws.send("end")
    }



</script>
</body>
</html>
