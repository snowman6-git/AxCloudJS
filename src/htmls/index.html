<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket 예제</title>
</head>
<body>
    <h1>WebSocket 통신 예제</h1>
    <input type="text" id="messageInput" placeholder="메시지를 입력하세요">
    <button id="sendButton">전송</button>
    <div id="messages"></div>

    <input type="file" onchange="check()" multiple />

<script>

    function check(){
    const files = event.target.files;
    for (let i = 0; i < files.length; i++) {
        console.log(files[i])
        upload(files[i])
    }  
    }
    let chunkSize = 1024
    const upload = async (file) => {
    const totalChunks = Math.ceil(file.size / chunkSize);
    let offset = 0;
    for (let i = 0; i < totalChunks; i++) {
        const chunk = file.slice(offset, offset + chunkSize);
        const formData = new FormData();
        formData.append('filename', file.name); // 파일 이름 추가
        formData.append('chunk', chunk); // 청크 추가
        ws.send(chunk)
    }
    ws.send("end")
    }



    const ws = new WebSocket('ws://localhost:3000/ws');

    ws.onopen = () => {
        console.log('서버에 연결되었습니다.');
    };


    // ws.onmessage = (event) => {
    //     const messagesDiv = document.getElementById('messages');
    //     messagesDiv.innerHTML += `<p>${event.data}</p>`;
    // };

    document.getElementById('sendButton').onclick = () => {
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value;
        ws.send(message);
        messageInput.value = '';
    };

    ws.onclose = () => {
        console.log('서버와의 연결이 끊어졌습니다.');
    };
</script>
</body>
</html>
